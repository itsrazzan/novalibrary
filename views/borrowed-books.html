<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buku yang Sedang Dipinjam - Nova Academy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 50%, #f3e8ff 100%);
            min-height: 100vh;
        }

        .gradient-purple {
            background: linear-gradient(135deg, #7c3aed 0%, #3b82f6 100%);
        }

        .gradient-text {
            background: linear-gradient(135deg, #7c3aed 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .book-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
        }

        .book-card:nth-child(1) { animation-delay: 0.1s; }
        .book-card:nth-child(2) { animation-delay: 0.2s; }
        .book-card:nth-child(3) { animation-delay: 0.3s; }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .book-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px -12px rgba(124, 58, 237, 0.35);
        }

        .btn-primary {
            background: linear-gradient(135deg, #7c3aed 0%, #3b82f6 100%);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px -8px rgba(124, 58, 237, 0.5);
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .progress-bar {
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            background: #e5e7eb;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="bg-white/90 backdrop-blur-lg shadow-lg fixed w-full top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <!-- Back Button -->
                    <button onclick="window.location.href='dashboard.html'" class="p-2 hover:bg-gray-100 rounded-lg transition">
                        <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                        </svg>
                    </button>
                    <!-- Logo -->
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 gradient-purple rounded-xl flex items-center justify-center shadow-lg">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                            </svg>
                        </div>
                        <span class="text-xl font-bold gradient-text">Nova Academy</span>
                    </div>
                </div>

                <!-- User Info -->
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 gradient-purple rounded-full flex items-center justify-center shadow-lg">
                        <span class="text-white font-bold" id="userInitial">U</span>
                    </div>
                    <span class="hidden md:block text-sm font-semibold text-gray-900" id="userName">User</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-24 pb-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-6xl mx-auto">
            <!-- Header -->
            <div class="mb-8">
                <h1 class="text-4xl font-bold text-gray-900 mb-3">
                    Buku yang Sedang <span class="gradient-text">Dipinjam</span>
                </h1>
                <p class="text-xl text-gray-600">Kelola dan pantau buku yang sedang Anda pinjam</p>
            </div>

            <!-- Summary Cards -->
            <div class="grid md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white rounded-2xl shadow-lg p-6 border-2 border-gray-100">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-semibold text-gray-600">Total Dipinjam</h3>
                        <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                            </svg>
                        </div>
                    </div>
                    <p class="text-3xl font-bold text-gray-900" id="totalBorrowed">0</p>
                </div>

                <div class="bg-white rounded-2xl shadow-lg p-6 border-2 border-gray-100">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-semibold text-gray-600">Jatuh Tempo Hari Ini</h3>
                        <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                    </div>
                    <p class="text-3xl font-bold text-gray-900" id="dueToday">0</p>
                </div>

                <div class="bg-white rounded-2xl shadow-lg p-6 border-2 border-gray-100">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-sm font-semibold text-gray-600">Terlambat</h3>
                        <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                            </svg>
                        </div>
                    </div>
                    <p class="text-3xl font-bold text-gray-900" id="overdue">0</p>
                </div>
            </div>

            <!-- Loading State -->
            <div id="loadingState" class="hidden text-center py-12">
                <svg class="animate-spin h-12 w-12 mx-auto text-purple-600 mb-4" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p class="text-gray-600">Memuat data...</p>
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="hidden bg-white rounded-2xl shadow-lg p-12 text-center">
                <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                    </svg>
                </div>
                <h3 class="text-2xl font-bold text-gray-900 mb-3">Belum Ada Buku yang Dipinjam</h3>
                <p class="text-gray-600 mb-6">Mulai pinjam buku untuk melanjutkan perjalanan belajar Anda</p>
                <button onclick="window.location.href='dashboard.html'" class="btn-primary px-8 py-3 text-white rounded-xl font-semibold">
                    Cari Buku
                </button>
            </div>

            <!-- Books List -->
            <div id="booksList" class="space-y-6">
                <!-- Books will be loaded here -->
            </div>
        </div>
    </main>

    <script>
        // Load User Info
        function loadUserInfo() {
            const username = localStorage.getItem('username') || sessionStorage.getItem('username');
            const authToken = localStorage.getItem('authToken') || sessionStorage.getItem('authToken');

            if (!authToken) {
                window.location.href = 'login.html';
                return;
            }

            const userName = username || 'User';
            const initial = userName.charAt(0).toUpperCase();

            document.getElementById('userInitial').textContent = initial;
            document.getElementById('userName').textContent = userName;
        }

        // Calculate days difference
        function calculateDaysLeft(dueDate) {
            const today = new Date();
            const due = new Date(dueDate);
            const diffTime = due - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('id-ID', options);
        }

        // Get status info
        function getStatusInfo(daysLeft) {
            if (daysLeft < 0) {
                return {
                    text: 'Terlambat ' + Math.abs(daysLeft) + ' hari',
                    class: 'bg-red-100 text-red-700',
                    icon: '⚠️'
                };
            } else if (daysLeft === 0) {
                return {
                    text: 'Jatuh tempo hari ini',
                    class: 'bg-orange-100 text-orange-700',
                    icon: '⏰'
                };
            } else if (daysLeft <= 3) {
                return {
                    text: 'Jatuh tempo ' + daysLeft + ' hari lagi',
                    class: 'bg-yellow-100 text-yellow-700',
                    icon: '⏳'
                };
            } else {
                return {
                    text: 'Jatuh tempo ' + daysLeft + ' hari lagi',
                    class: 'bg-green-100 text-green-700',
                    icon: '✓'
                };
            }
        }

        // Calculate progress
        function calculateProgress(borrowDate, dueDate) {
            const borrow = new Date(borrowDate);
            const due = new Date(dueDate);
            const today = new Date();
            
            const total = due - borrow;
            const elapsed = today - borrow;
            const progress = Math.min(100, Math.max(0, (elapsed / total) * 100));
            
            return Math.round(progress);
        }

        // Get progress color
        function getProgressColor(progress) {
            if (progress >= 90) return '#ef4444';
            if (progress >= 70) return '#f59e0b';
            return '#10b981';
        }

        // Render borrowed books
        function renderBorrowedBooks(books) {
            const booksList = document.getElementById('booksList');
            const loadingState = document.getElementById('loadingState');
            const emptyState = document.getElementById('emptyState');

            loadingState.classList.add('hidden');

            if (books.length === 0) {
                emptyState.classList.remove('hidden');
                booksList.innerHTML = '';
                return;
            }

            emptyState.classList.add('hidden');

            booksList.innerHTML = books.map(function(book) {
                const daysLeft = calculateDaysLeft(book.dueDate);
                const status = getStatusInfo(daysLeft);
                const progress = calculateProgress(book.borrowDate, book.dueDate);
                const progressColor = getProgressColor(progress);

                return '<div class="book-card bg-white rounded-2xl shadow-lg p-6 border-2 border-gray-100">' +
                    '<div class="flex flex-col md:flex-row gap-6">' +
                        '<img src="' + book.cover + '" alt="' + book.title + '" class="w-full md:w-32 h-48 object-cover rounded-xl shadow-md">' +
                        '<div class="flex-1">' +
                            '<div class="flex flex-col md:flex-row md:items-start md:justify-between mb-4">' +
                                '<div class="flex-1 mb-4 md:mb-0">' +
                                    '<h3 class="text-2xl font-bold text-gray-900 mb-2">' + book.title + '</h3>' +
                                    '<p class="text-gray-600 mb-1">Oleh: <span class="font-semibold">' + book.author + '</span></p>' +
                                    '<p class="text-sm text-gray-500">ISBN: ' + book.isbn + '</p>' +
                                '</div>' +
                                '<span class="status-badge px-4 py-2 rounded-full text-sm font-semibold ' + status.class + '">' +
                                    status.icon + ' ' + status.text +
                                '</span>' +
                            '</div>' +
                            
                            '<div class="grid md:grid-cols-2 gap-4 mb-4">' +
                                '<div class="bg-gray-50 rounded-xl p-4">' +
                                    '<p class="text-xs text-gray-500 mb-1">Tanggal Pinjam</p>' +
                                    '<p class="font-semibold text-gray-900">' + formatDate(book.borrowDate) + '</p>' +
                                '</div>' +
                                '<div class="bg-gray-50 rounded-xl p-4">' +
                                    '<p class="text-xs text-gray-500 mb-1">Tanggal Jatuh Tempo</p>' +
                                    '<p class="font-semibold text-gray-900">' + formatDate(book.dueDate) + '</p>' +
                                '</div>' +
                            '</div>' +

                            '<div class="mb-4">' +
                                '<div class="flex justify-between items-center mb-2">' +
                                    '<p class="text-sm font-semibold text-gray-700">Progress Peminjaman</p>' +
                                    '<p class="text-sm font-bold" style="color: ' + progressColor + '">' + progress + '%</p>' +
                                '</div>' +
                                '<div class="progress-bar">' +
                                    '<div class="progress-fill" style="width: ' + progress + '%; background-color: ' + progressColor + '"></div>' +
                                '</div>' +
                            '</div>' +

                            '<div class="flex flex-col sm:flex-row gap-3">' +
                                '<button onclick="extendLoan(' + book.id + ')" class="flex-1 px-6 py-3 bg-purple-600 text-white rounded-xl font-semibold hover:bg-purple-700 transition flex items-center justify-center gap-2">' +
                                    '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>' +
                                    'Perpanjang Pinjaman' +
                                '</button>' +
                                '<button onclick="returnBook(' + book.id + ')" class="flex-1 px-6 py-3 bg-green-600 text-white rounded-xl font-semibold hover:bg-green-700 transition flex items-center justify-center gap-2">' +
                                    '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>' +
                                    'Kembalikan Buku' +
                                '</button>' +
                            '</div>' +
                        '</div>' +
                    '</div>' +
                '</div>';
            }).join('');

            // Update summary
            updateSummary(books);
        }

        // Update summary stats
        function updateSummary(books) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            let dueToday = 0;
            let overdue = 0;

            books.forEach(function(book) {
                const daysLeft = calculateDaysLeft(book.dueDate);
                if (daysLeft === 0) dueToday++;
                if (daysLeft < 0) overdue++;
            });

            document.getElementById('totalBorrowed').textContent = books.length;
            document.getElementById('dueToday').textContent = dueToday;
            document.getElementById('overdue').textContent = overdue;
        }

        // Extend loan
        function extendLoan(bookId) {
            if (confirm('Apakah Anda yakin ingin memperpanjang peminjaman buku ini?')) {
                alert('Fitur perpanjangan akan tersedia setelah integrasi dengan backend.\nBuku ID: ' + bookId);
            }
        }

        // Return book
        function returnBook(bookId) {
            if (confirm('Apakah Anda yakin ingin mengembalikan buku ini?')) {
                alert('Fitur pengembalian akan tersedia setelah integrasi dengan backend.\nBuku ID: ' + bookId);
            }
        }

        // Load borrowed books from database
        async function loadBorrowedBooks() {
            const loadingState = document.getElementById('loadingState');
            loadingState.classList.remove('hidden');

            try {
                // Connect to database API
                /*
                const authToken = localStorage.getItem('authToken') || sessionStorage.getItem('authToken');
                const response = await fetch('api/borrowed-books.php', {
                    headers: {
                        'Authorization': 'Bearer ' + authToken
                    }
                });
                const data = await response.json();
                renderBorrowedBooks(data.books);
                */

                // DEMO: Sample data
                await new Promise(function(resolve) { setTimeout(resolve, 1000); });

                const sampleBooks = [
                    {
                        id: 1,
                        title: 'Laskar Pelangi',
                        author: 'Andrea Hirata',
                        isbn: '9789793062792',
                        cover: 'https://images.unsplash.com/photo-1544947950-fa07a98d237f?w=400&h=600&fit=crop',
                        borrowDate: '2024-12-10',
                        dueDate: '2024-12-27'
                    },
                    {
                        id: 2,
                        title: 'Bumi Manusia',
                        author: 'Pramoedya Ananta Toer',
                        isbn: '9789799731234',
                        cover: 'https://images.unsplash.com/photo-1543002588-bfa74002ed7e?w=400&h=600&fit=crop',
                        borrowDate: '2024-12-05',
                        dueDate: '2024-12-24'
                    },
                    {
                        id: 3,
                        title: 'Negeri 5 Menara',
                        author: 'Ahmad Fuadi',
                        isbn: '9789791227742',
                        cover: 'https://images.unsplash.com/photo-1512820790803-83ca734da794?w=400&h=600&fit=crop',
                        borrowDate: '2024-12-01',
                        dueDate: '2024-12-22'
                    }
                ];

                renderBorrowedBooks(sampleBooks);

            } catch (error) {
                console.error('Error loading borrowed books:', error);
                loadingState.classList.add('hidden');
                alert('Terjadi kesalahan saat memuat data');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadUserInfo();
            loadBorrowedBooks();
        });
    </script>
</body>
</html>